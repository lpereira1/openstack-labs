---
date: "2017-02-27"
draft: true
weight: 380
title: "Lab 38 - Creating a Stack with Heat"
---
[Click here to find out more about Alta3 Research's Openstack Training](https://alta3.com/courses/openstack)

### THURSDAY - &#x2B50;REQUIRED&#x2B50;

### Lab Objective

The objective of this lab is to show students how to launch a Heat stack.

### Procedure

0. From your remote desktop, open a terminal session, and move to the student home directory.

    `student@beachhead:/$` `ssh controller`

0. Confirm that the python-openstackclient is not currently installed. To be clear, the following command should fail.

    `student@controller:~$` `source admin.rc`

0. First, let's confirm that Heat is available. The following command should return an empty line.

    `student@beachhead (admin) :~$` `openstack stack list`

0. Okay, great. Now let's prepare to creat a stack. Retrieve the list of available flavors on your system (this is review).

    `student@beachhead (admin) :~$` `openstack flavor list`
    
0. Continuing to create our stack. Retrieve the list of available images on your system (this is review).

    `student@beachhead (admin) :~$` `openstack image list`
    
0. After we launch an instance with Heat, you'll want to be able to SSH into with a keypair. Let's produce a key just for use with our machines created with Heat (this is review).

    `student@beachhead (admin) :~$` `openstack keypair create heat_key > heat_key.priv`
    
0. Change the permissions on the key we created, so that it is usable.

    `student@beachhead (admin) :~$` `chmod 600 heat_key.priv`

0. We've already created a Heat template for use with this lab. Download it, and inspect it.

    `student@beachhead (admin) :~$` `curl http://github.com/alta3/openstack-labs/blob/no_wake_zone/heat_helloworld.yaml`
    
 0. Run the stack.
 
    `student@beachhead (admin) :~$` `openstack stack create -t heat_helloworld.yaml --parameter key_name=heat_key --parameter image_id=cirros --parameter instance_type=m1.small teststack`
 
 0. It failed. Troubleshoot why.
 
    `student@beachhead (admin) :~$` `openstack stack event list teststack`
    
0. What was the reason?

0. Rather than have you edit this template, why don't you just download a new template that allows you to pass a network and subnet parameter.

    `student@beachhead (admin) :~$` `curl http://github.com/alta3/openstack-labs/blob/no_wake_zone/heat_helloworld_2.yaml`
    
0. Look at the template that was just downloaded. Notice that now the template is looking for parameters to define the network and subnet for the instance to be launched on.

    `student@beachhead (admin) :~$` `cat heat_helloworld_2.yaml`
    
0. Run the new stack, this time, we will indicate with two new parameters the network and subnet we want to launch the instance on. This should fix our previous issue.

    `student@beachhead (admin) :~$` `openstack stack create -t heat_helloworld_2.yaml --parameter key_name=heat_key --parameter image_id=cirros --parameter instance_type=m1.small --parameter subnet_name=provider-subnet teststack2`
    
    
 
#### Additional Learning / References

The following are a list of pages we thought might be helpful for our students to know about:

* [Heat Template Guide - Basic Resources](https://docs.openstack.org/developer/heat/template_guide/basic_resources.html#)
